<!DOCTYPE html>
<html lang="en" data-theme="winter">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rep Performance Dashboard v1.4</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: 'Inter', sans-serif; }
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: var(--bg-app); }
        ::-webkit-scrollbar-thumb { background: var(--border-color); border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--primary); }

        :root {
            --bg-app: #f1f5f9; --bg-card: #ffffff; --bg-input: #f8fafc;
            --text-main: #1e293b; --text-muted: #64748b; --border-color: #e2e8f0;
            --primary: #4f46e5; --primary-fg: #ffffff;
            --shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            --color-srmgr: #f97316; --color-mgr: #06b6d4; --color-sup: #22c55e; --color-gold: #facc15;
        }
        [data-theme="midnight"] { --bg-app: #0f172a; --bg-card: #1e293b; --bg-input: #334155; --text-main: #f8fafc; --text-muted: #94a3b8;
            --border-color: #334155; --primary: #38bdf8; --primary-fg: #0f172a; }
        [data-theme="oled"] { --bg-app: #000000; --bg-card: #121212;
            --bg-input: #2a2a2a; --text-main: #ffffff; --text-muted: #a1a1aa; --border-color: #27272a; --primary: #facc15; --primary-fg: #000000;
        }
        [data-theme="forest"] { --bg-app: #ecfdf5; --bg-card: #ffffff; --bg-input: #f0fdf4; --text-main: #064e3b; --text-muted: #65a30d;
            --border-color: #bbf7d0; --primary: #16a34a; --primary-fg: #ffffff; }
        [data-theme="ocean"] { --bg-app: linear-gradient(135deg, #e0f2fe 0%, #f0f9ff 100%);
            --bg-card: rgba(255,255,255,0.95); --bg-input: rgba(255,255,255,0.8); --text-main: #0c4a6e; --text-muted: #0284c7; --border-color: #bae6fd; --primary: #0284c7; --primary-fg: #ffffff;
        }
        [data-theme="sunset"] { --bg-app: #fff7ed; --bg-card: #ffffff; --bg-input: #ffedd5; --text-main: #7c2d12; --text-muted: #c2410c;
            --border-color: #fed7aa; --primary: #ea580c; --primary-fg: #ffffff; }
        [data-theme="cyber"] { --bg-app: #050505; --bg-card: #11001c;
            --bg-input: #240046; --text-main: #e0aaff; --text-muted: #9d4edd; --border-color: #5a189a; --primary: #ff00ff; --primary-fg: #11001c; --shadow: 0 0 10px #ff00ff;
        }
        [data-theme="holiday-cheer"] { --bg-app: #f0fdf4; --bg-card: #ffffff; --bg-input: #fff1f2; --text-main: #14532d; --text-muted: #991b1b;
            --border-color: #166534; --primary: #dc2626; --primary-fg: #ffffff; --accent-warning: #fbbf24; }
        [data-theme="winter"] { --bg-app: linear-gradient(to bottom, #eff6ff, #dbeafe);
            --bg-card: #ffffff; --bg-input: #f0f9ff; --text-main: #1e3a8a; --text-muted: #60a5fa; --border-color: #bfdbfe; --primary: #2563eb; --primary-fg: #ffffff;
        }
        [data-theme="harvest"] { --bg-app: #fffbeb; --bg-card: #ffffff; --bg-input: #fff7ed; --text-main: #78350f; --text-muted: #d97706;
            --border-color: #fcd34d; --primary: #d97706; --primary-fg: #ffffff; }

        .bg-app { background-color: var(--bg-app);
        } .bg-card { background-color: var(--bg-card); } .bg-input { background-color: var(--bg-input);
        }
        .text-main { color: var(--text-main); } .text-muted { color: var(--text-muted);
        } .border-color { border-color: var(--border-color); }
        .shadow-theme { box-shadow: var(--shadow);
        }
        .bg-primary { background-color: var(--primary); color: var(--primary-fg);
        }
        .sidebar-header { background-color: var(--primary); color: var(--primary-fg);
        }
        
        .hierarchy-item:hover { background-color: var(--border-color);
        }
        .hierarchy-item.active { background-color: var(--border-color); border-left: 4px solid var(--primary);
        }
        
        .color-srmgr { color: var(--color-srmgr);
        font-weight: 700; }
        .color-mgr { color: var(--color-mgr); font-weight: 600;
        }
        .color-sup { color: var(--color-sup); font-weight: 600;
        }
        .color-gold { color: var(--color-gold); font-weight: 600;
        }
        
        .page { display: none;
        } #page-review.active, #page-create.active { display: block; animation: fadeIn 0.3s ease-in-out;
        }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px);
        } to { opacity: 1; transform: translateY(0); } }
        
        #review-date-slider { -webkit-appearance: none;
        background: var(--border-color); }
        #review-date-slider::-webkit-slider-thumb { -webkit-appearance: none; width: 16px; height: 16px; border-radius: 50%;
        background: var(--primary); cursor: pointer; }

        @media print {
            body * { visibility: hidden;
            } #print-section, #print-section * { visibility: visible; }
            #print-section { position: absolute;
            left: 0; top: 0; width: 100%; padding: 40px; color: #000; background: #fff;
            }
            .no-print { display: none !important;
            }
            .bg-card, .bg-app { background-color: white !important;
            } .text-main { color: black !important; }
        }
    </style>
</head>
<body class="bg-app antialiased h-screen flex overflow-hidden">

    <div class="w-1/4 min-w-[300px] bg-card border-r border-color flex flex-col shadow-theme z-10">
        <div class="p-4 border-b border-color sidebar-header">
            <h1 class="text-xl font-bold">Performance Hub</h1>
            <p class="text-xs opacity-80">Dataverse Connected</p>
        </div>
        <div class="flex-1 overflow-y-auto">
    
                <div class="border-b border-color"><button onclick="toggleSection('dept')" class="w-full text-left p-3 bg-input font-semibold text-xs text-muted uppercase flex justify-between">Department <span id="chev-dept">‚ñº</span></button><div id="list-dept" class="p-2 space-y-1"></div></div>
            <div class="border-b border-color"><button onclick="toggleSection('mgr')" class="w-full text-left p-3 bg-input font-semibold text-xs text-muted uppercase flex justify-between">Manager Group <span id="chev-mgr">‚ñº</span></button><div id="list-mgr" class="p-2 space-y-1"></div></div>
            <div class="border-b border-color"><button onclick="toggleSection('sup')" class="w-full text-left p-3 bg-input font-semibold text-xs text-muted uppercase flex justify-between">Supervisor Group <span id="chev-sup">‚ñº</span></button><div id="list-sup" class="p-2 space-y-1"></div></div>
            
<div class="border-b border-color"><button onclick="filterReps('GoldStar', true, this)" class="hierarchy-item block w-full text-left p-3 bg-input font-semibold text-xs text-muted uppercase">Gold Star Reps üåü</button></div>
            <div class="flex-1"><button onclick="toggleSection('rep')" class="w-full text-left p-3 bg-input font-semibold text-xs text-muted uppercase flex justify-between">Representative <span id="chev-rep">‚ñ≤</span></button><div id="list-rep" class="p-2 space-y-1"></div></div>
        </div>
        <div class="p-4 border-t border-color bg-input">
            <button onclick="triggerFlowSync()" class="w-full bg-card border border-color text-main py-2 rounded shadow-theme hover:bg-input text-sm font-medium flex justify-center items-center gap-2">
     
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg>
                Sync with Flow
            </button>
        </div>
    </div>

    <div class="flex-1 flex flex-col overflow-hidden relative">
        <header class="bg-card border-b border-color p-4 
            flex justify-between items-center shadow-theme">
            <div><h2 id="view-title" class="text-2xl font-bold text-main">Dashboard</h2><p id="view-subtitle" class="text-sm text-muted">Select an employee</p></div>
            <div class="flex gap-3 items-center">
                <select id="theme-select" onchange="applyTheme(this.value)" class="p-2 text-sm border border-color rounded bg-input text-main shadow-theme">
                    <option value="winter">Winter</option><option value="midnight">Midnight</option><option value="oled">OLED</option><option value="forest">Forest</option><option value="ocean">Ocean</option><option value="sunset">Sunset</option><option value="cyber">Cyber</option><option value="harvest">Harvest</option><option value="holiday-cheer">Holiday</option>
      
                    </select>
                <button onclick="openCreateReviewModal()" id="btn-new-review" class="bg-primary text-primary-fg px-4 py-2 rounded shadow-theme text-sm hidden no-print">New Review</button>
                <button onclick="openExportModal()" class="bg-primary text-primary-fg px-4 py-2 rounded shadow-theme text-sm no-print">Export / Sign</button>
            </div>
        </header>

        <main class="flex-1 overflow-y-auto p-6 bg-app">
   
                <div id="page-review" class="page max-w-6xl mx-auto space-y-6">
                <div class="flex justify-between items-end bg-card p-4 rounded-xl shadow-theme">
                    <div class="w-full max-w-md space-y-2">
                        <div class="flex justify-between"><label class="text-xs font-bold text-muted uppercase">Period Ending</label><span id="current-review-date-display" class="text-sm font-bold text-main">--</span></div>
     
                        <input type="range" id="review-date-slider" class="w-full h-2 bg-input rounded-lg cursor-pointer" min="0" max="0" value="0" oninput="updateDashboardFromSlider()">
                        <div class="flex gap-2 items-center"><label class="text-xs font-bold text-muted uppercase">Compare:</label><select id="duration-select" onchange="updateDashboardFromSlider()" class="p-1 text-xs border border-color rounded bg-input text-main"><option value="1">Monthly</option><option value="3">Quarterly</option><option value="6">6 Months</option><option value="12">Annual</option></select></div>
                    </div>
     
                        <div class="text-right"><div class="text-sm text-muted">Reports to</div><div id="manager-name" class="font-medium text-main">--</div></div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="bg-card rounded-xl shadow-theme p-5 border border-color">
                
                        <h3 class="text-lg font-bold text-main mb-4">Performance Metrics</h3>
                        <div class="overflow-x-auto"><table class="min-w-full"><thead class="bg-input text-xs uppercase text-muted"><tr><th class="px-4 py-2 text-left">KPI</th><th class="px-4 py-2 text-right">Target</th><th class="px-4 py-2 text-right">Actual</th><th class="px-4 py-2 text-center">Trend</th></tr></thead><tbody id="kpi-table-body"><tr><td colspan="4" class="text-center py-8 text-muted">Select an employee to view data.</td></tr></tbody></table></div>
                    </div>
               
                        <div class="bg-card rounded-xl shadow-theme p-5 border border-color flex flex-col">
                        <h3 class="text-lg font-bold text-main mb-4">Metric Trend</h3>
                        <div class="flex gap-2 items-center mb-4"><label class="text-xs font-bold text-muted uppercase">KPI:</label><select id="chart-kpi-select" onchange="updateChart()" class="p-1 text-xs border border-color rounded bg-input text-main"></select></div>
                 
                        <div class="flex-1 min-h-[250px]"><canvas id="trendChart"></canvas></div>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <div class="bg-card rounded-xl shadow-theme p-5 border border-color"><h4 class="font-bold text-main text-lg mb-2">üéØ Opportunities This 
                        Period</h4><ul id="text-opps-this" class="list-disc ml-6 text-sm text-main space-y-1"></ul></div>
                    <div class="bg-card rounded-xl shadow-theme p-5 border border-color"><h4 class="font-bold text-main text-lg mb-2">üöÄ Action Plan</h4><ul id="text-action-plan" class="list-disc ml-6 text-sm text-main space-y-1"></ul></div>
                    <div class="bg-card rounded-xl shadow-theme p-5 border border-color"><h4 class="font-bold text-main text-lg mb-2">‚ú® Best Practices / Recognition</h4><ul id="text-best-practices" class="list-disc ml-6 text-sm text-main space-y-1"></ul></div>
                
                        <div class="lg:col-span-3 bg-card rounded-xl shadow-theme p-5 border border-color"><h4 class="font-bold text-main text-lg mb-2">üó£Ô∏è Agent's Voice</h4><p id="text-agent-voice" class="italic p-3 bg-input rounded text-main text-sm"></p></div>
                </div>
                
                <div class="bg-card rounded-xl shadow-theme p-5 border border-color"><h4 class="font-bold text-main text-lg mb-2">Previous Period Opportunities</h4><ul id="text-opps-last" class="list-disc ml-6 text-sm text-muted space-y-1"></ul></div>

          
                        <div id="print-section" class="no-print hidden">
                    <h1 class="text-2xl font-bold text-black mb-1">Rep Performance Review</h1>
                    <p id="print-subtitle" class="text-lg text-gray-700 mb-2"></p>
                    <p id="print-date" class="text-md text-gray-600 mb-6"></p>

                 
                        <h3 class="text-xl font-bold text-black mb-3">Performance Metrics</h3>
                    <table class="w-full border-collapse border border-gray-300 mb-6">
                        <thead class="bg-gray-100 text-sm font-bold uppercase"><tr><th class="p-2 text-left">KPI</th><th class="p-2 text-right">Target</th><th class="p-2 text-right">Actual</th><th class="p-2 text-center">Status</th></tr></thead>
                        <tbody id="print-table-body"></tbody>
      
                        </table>

                    <div id="print-text-content" class="space-y-6 text-black text-base"></div>
                    
                    <div class="mt-12 pt-6 border-t border-gray-300 flex justify-between text-black">
               
                        <div>Manager Signature: _________________________</div>
                        <div>Employee Signature: _________________________</div>
                    </div>
                </div>
            </div>

            <div id="page-create" class="page 
                max-w-2xl mx-auto bg-card rounded-xl shadow-theme p-6 space-y-6">
                <h2 class="text-2xl font-bold text-main">New Review for <span id="new-review-rep-name" class="text-primary"></span></h2>
                <div class="grid grid-cols-2 gap-4">
                    <div><label class="block font-bold text-main">Review Date</label><input type="month" id="form-date" class="w-full border border-color rounded p-2 bg-input text-main"></div>
                  
                        <div><label class="block font-bold text-main">Review Type</label><select id="form-type" class="w-full border border-color rounded p-2 bg-input text-main"><option>EOM</option><option>Mid-Month</option><option>Quarterly</option></select></div>
                </div>

                <div class="border-t border-color pt-4"><h3 class="font-bold text-xl text-main mb-3">KPI Inputs</h3><div id="form-kpi-inputs" class="grid grid-cols-2 gap-4"></div></div>

                <div class="border-t border-color pt-4"><h3 class="font-bold text-xl text-main mb-3">Qualitative Feedback</h3>
                  
                        <div><label class="block font-bold text-main mb-1">Opportunities This Period</label><textarea id="form-opps-this" class="w-full border border-color rounded p-2 bg-input text-main h-24"></textarea></div>
                    <div><label class="block font-bold text-main mb-1">Action Plan</label><textarea id="form-action-plan" class="w-full border border-color rounded p-2 bg-input text-main h-24"></textarea></div>
                    <div><label class="block font-bold text-main mb-1">Best Practices / Recognition</label><textarea id="form-best-practices" class="w-full border border-color rounded p-2 bg-input text-main h-24"></textarea></div>
                
                        <div><label class="block font-bold text-main mb-1">Agent's Voice</label><textarea id="form-agent-voice" class="w-full border border-color rounded p-2 bg-input text-main h-20"></textarea></div>
                </div>
                
                <button onclick="saveNewReview()" class="w-full bg-primary text-primary-fg py-3 rounded-lg shadow-theme font-bold hover:opacity-90">Finalize and Save Review</button>
            </div>
        </main>
   
        </div>

    <script>
        // --- 1. GLOBAL VARIABLES ---
        let currentRepId = null;
        let currentFilter = { type: 'All', value: null };
        let reviewDateRange = [];
        let dbReviews = [];
        let dbLogs = [];
        let currentReview = null;
        let chartInstance = null;
        // --- 2. FLOW CONFIG ---
        // !!!
        // IMPORTANT: THIS URL NOW POINTS TO YOUR POWER AUTOMATE FLOW !!!
        const GET_DATA_FLOW_URL = "https://e25b831597b0e29e9b9b7f764adfe8.0f.environment.api.powerplatform.com:443/powerautomate/automations/direct/workflows/c82c5aa6117a4df3b1f8dbb0f8a098bb/triggers/manual/paths/invoke?api-version=1&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=9NlNJzdB9nO-12No3oVcrptS45NC6I9gsFtokTeH_6E"; 
        const SAVE_DATA_FLOW_URL = "https://e25b831597b0e29e9b9b7f764adfe8.0f.environment.api.powerplatform.com:443/powerautomate/automations/direct/workflows/088be03ff3724bb4ac49e37532d96136/triggers/manual/paths/invoke?api-version=1&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=v6SCxqGlx31Skbx2CaPpD3sXlwh-apo169avyrv0OTk";
        // --- 3. DATASETS ---
        // We will now load this data from the Power Automate flow instead of hard-coding it.
        let rawEmployees = []; 
        let employees = []; // Filtered list of active employees
        let employeeMap = {};
        // Map for quick lookups

        // KPI Configurations (Metrics shown per department)
        const kpiConfigs = {
            "Sales": [{id:"calls",label:"Calls Answered",target:120,type:"number",agg:"sum"},{id:"hold",label:"Hold Time (%)",target:10,type:"percent",agg:"avg"},{id:"quality",label:"Quality Score",target:90,type:"percent",agg:"avg"},{id:"invoices",label:"Invoices",target:25,type:"number",agg:"sum"}],
            "Quotes": [{id:"quotes",label:"Quotes Generated",target:150,type:"number",agg:"sum"},{id:"conversion",label:"Conversion Rate",target:25,type:"percent",agg:"avg"},{id:"quality",label:"Quality Score",target:90,type:"percent",agg:"avg"}],
            "Food Service": [{id:"orders",label:"Food Orders",target:80,type:"number",agg:"sum"},{id:"margin",label:"Gross Margin (%)",target:35,type:"percent",agg:"avg"},{id:"quality",label:"Quality Score",target:90,type:"percent",agg:"avg"}],
            "Account Management 1": [{id:"value",label:"Account Value ($)",target:100000,type:"currency",agg:"sum"},{id:"retention",label:"Retention Rate",target:95,type:"percent",agg:"avg"},{id:"nps",label:"NPS Score",target:50,type:"number",agg:"avg"}],
 
            "Account Management 2": [{id:"contacts",label:"Contact Rate",target:90,type:"percent",agg:"avg"},{id:"upsell",label:"Upsell Ratio",target:1.5,type:"number",agg:"avg"},{id:"quality",label:"Quality Score",target:90,type:"percent",agg:"avg"}],
            "Account Management 3": [{id:"csat",label:"CSAT Score",target:9.5,type:"number",agg:"avg"},{id:"ttr",label:"Ticket Turnaround (hrs)",target:48,type:"number",agg:"avg"},{id:"quality",label:"Quality Score",target:90,type:"percent",agg:"avg"}],
            "Retention": [{id:"saved",label:"Accounts Saved",target:50,type:"number",agg:"sum"},{id:"saveRate",label:"Save Rate (%)",target:75,type:"percent",agg:"avg"},{id:"quality",label:"Quality Score",target:90,type:"percent",agg:"avg"}],
            "Logistics": [{id:"issues",label:"Logistics Issues",target:5,type:"number",agg:"sum",inverse:true},{id:"ontime",label:"On-Time Delivery",target:98,type:"percent",agg:"avg"},{id:"quality",label:"Quality Score",target:90,type:"percent",agg:"avg"}],
            "Chat": [{id:"chats",label:"Chats Handled",target:180,type:"number",agg:"sum"},{id:"aht",label:"Average Handle Time (m)",target:5,type:"number",agg:"avg",inverse:true},{id:"quality",label:"Quality Score",target:90,type:"percent",agg:"avg"}],
            "New 
            Hire In Training": [{id:"training",label:"Training Modules Complete",target:100,type:"percent",agg:"avg"},{id:"shadow",label:"Shadow Sessions (hrs)",target:40,type:"number",agg:"sum"},{id:"quiz",label:"Quiz Score",target:85,type:"percent",agg:"avg"}],
            "SR Management": [{id:"coaching",label:"Coaching Sessions",target:10,type:"number",agg:"sum"},{id:"reviews",label:"Reviews Completed",target:20,type:"number",agg:"sum"}],
            "Specialty": [{id:"custom",label:"Custom Orders",target:20,type:"number",agg:"sum"},{id:"accuracy",label:"Order Accuracy",target:99,type:"percent",agg:"avg"},{id:"quality",label:"Quality Score",target:90,type:"percent",agg:"avg"}],
            "Jacksonville": [{id:"sales",label:"Jax Sales Volume ($)",target:50000,type:"currency",agg:"sum"},{id:"leads",label:"Leads Generated",target:50,type:"number",agg:"sum"}],
            "Analytics/Workforce": [{id:"reports",label:"Reports Completed",target:15,type:"number",agg:"sum"},{id:"data_accuracy",label:"Data Accuracy (%)",target:99,type:"percent",agg:"avg"}],
            "Unknown": [{id:"default",label:"Default KPI",target:1,type:"number",agg:"sum"}]
        };
        // Sample data to simulate qualitative feedback
        const qualitativeSamples = {
            "text-opps-this": ["Focus on building rapport before presenting solutions.","Reduce average ticket turnaround time to below 48 hours."],
            "text-opps-last": ["Needs to practice active listening. (Resolved)","Improve knowledge of the new logistics system."],
            "text-best-practices": ["Excellent use of upselling techniques on high-value accounts.","Consistently high CSAT scores for Q3."],
       
            "text-action-plan": ["Complete the 'Advanced Rapport Building' training module by month end.","Shadow a senior rep for 4 hours next week focusing on ticket resolution."],
            "text-agent-voice": "I appreciate the feedback on rapport building. I felt overwhelmed with ticket volume this month but am committed to improving my approach next month."
        };

        // --- 4. DATA FETCHING (NEW FLOW LOGIC) ---
        async function fetchEmployeeData() {
            try {
                const response = await fetch(GET_DATA_FLOW_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
 
                    // We send an empty body as the flow doesn't need input to run
                    body: JSON.stringify({})
                });
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                // 1. Store the raw data
                rawEmployees = data;
                // 2. Filter employees for activity (the flow should handle this, but for safety...)
                // If your flow returns only active reps, this filter is redundant but safe.
                // If your flow returns all reps, use a column to filter terminated ones.
                // Since the flow is now filtering, we assume 'rawEmployees' only contains active reps.
                employees = rawEmployees;
                // 3. Create the lookup map
                employeeMap = employees.reduce((map, emp) => {
                    map[emp.id] = emp;
                    return map;
                }, {});
                console.log(`Successfully loaded ${employees.length} active employees.`);
            } catch (error) {
                console.error("Failed to fetch employee data from Power Automate Flow:", error);
                // Fallback: Use a small, hardcoded list if the flow fails
                rawEmployees = [{id: 999, name: "Flow Error", role: "Rep", dept: "Unknown", isGoldStar: false, managerId: null, supervisorId: null}];
                employees = rawEmployees;
                employeeMap = employees.reduce((map, emp) => { map[emp.id] = emp; return map; }, {});
                alert("Warning: Could not load data from Power Automate. Displaying fallback data.");
            }
        }

        // --- 5. CORE LOGIC (UPDATED) ---

        // Function to generate simulated performance data
        function generateSimulatedData(employeeList) {
            // Reset global data arrays
            dbReviews = [];
            dbLogs = [];
            
            // This loop now runs on the 'employeeList' (the data loaded from the flow)
            employeeList.forEach(emp => {
                if (emp.role !== 'Rep') return; // Only process Reps for simulation

                const kpis = kpiConfigs[emp.dept] || kpiConfigs["Sales"];

                // --- Generate Monthly Reviews ---
  
                reviewDateRange.forEach((date, index) => {
                    const isGoldStar = emp.isGoldStar && index > 5;
                    
                    const review = {
             
                        reviewId: `${emp.id}-${date.replace('-', '')}`,
                        repId: emp.id,
                        repName: emp.name,
                        reviewDate: date,
            
                        type: 'EOM',
                        reviewerLevel: 'Manager',
                        kpiData: kpis.map(k => ({
                            id: k.id,
      
                            label: k.label,
                            target: k.target,
                            actual: k.target * (1 + (Math.random() - 0.5) * (isGoldStar ?
                                0.05 : 0.2)),
                            trend: (Math.random() > 0.5 ? 'up' : 'down'),
                            type: k.type,
                            agg: k.agg
     
                        })),
                        // Pull qualitative samples based on the index or other logic
                        oppsThis: qualitativeSamples["text-opps-this"].join('\n'),
                      
                        actionPlan: qualitativeSamples["text-action-plan"].join('\n'),
                        bestPractices: qualitativeSamples["text-best-practices"].join('\n'),
                        agentVoice: qualitativeSamples["text-agent-voice"],
                        previousReviewId: index > 0 ?
                            `${emp.id}-${reviewDateRange[index-1].replace('-', '')}` : null
                    };
                    dbReviews.push(review);
                });

                // --- Generate Log Data (for chart trends) ---
                kpis.forEach(kpi => {
                    reviewDateRange.forEach((date, index) => {
                        const isGoldStar = emp.isGoldStar && index > 5;
                        const log = {
                            logId: `${emp.id}-${kpi.id}-${date.replace('-', '')}`,
                            repId: emp.id,
                            kpiId: kpi.id,
                            date: date,
                            value: kpi.target * (1 + (Math.random() - 0.5) * (isGoldStar ? 0.05 : 0.2))
                        };
                        dbLogs.push(log);
                    });
                });
            });
        }

        // Function to set up and render the Department, Manager, Supervisor, and Rep lists
        function setupHierarchy(employeeList) {
            const hierarchy = { dept: new Set(), mgr: new Set(), sup: new Set(), rep: new Set() };

            employeeList.forEach(emp => {
                if (emp.dept) hierarchy.dept.add(emp.dept);
                // The names for managers/supervisors are looked up from the list itself
                if (emp.managerId) {
                    const manager = employeeMap[emp.managerId];
                    if (manager) hierarchy.mgr.add(manager.name);
                }
                if (emp.supervisorId) {
                    const supervisor = employeeMap[emp.supervisorId];
                    if (supervisor) hierarchy.sup.add(supervisor.name);
                }
                // Only list reps in the rep section if they are 'Rep' role or below
                if (emp.role === 'Rep' || emp.role === 'Director') { // Assuming 'Director' means a regular employee in this context
                    hierarchy.rep.add(emp.name);
                }
            });

            // Helper to render lists
            const renderList = (id, set, type) => {
                document.getElementById(id).innerHTML = Array.from(set).sort().map(item =>
                    `<button onclick="filterReps('${type}', '${item}', this)" class="hierarchy-item block w-full text-left px-3 py-1.5 text-sm text-main hover:bg-input rounded">${item}</button>`
                ).join('');
            };

            renderList('list-dept', hierarchy.dept, 'dept');
            renderList('list-mgr', hierarchy.mgr, 'mgr');
            renderList('list-sup', hierarchy.sup, 'sup');

            const listRep = document.getElementById('list-rep');
            listRep.innerHTML = Array.from(hierarchy.rep).sort().map(name => {
                const emp = employeeList.find(e => e.name === name);
                // Use the first 3 letters of the role for coloring (rep, mgr, sup, srm...)
                const roleClass = (emp && emp.role) ? emp.role.toLowerCase().slice(0, 3) : 'rep'; 
                return `<button onclick="loadRepDashboard(${emp.id})" class="hierarchy-item block w-full text-left px-3 py-1.5 text-sm text-main hover:bg-input rounded"><span class="color-${roleClass}">${name}</span></button>`;
            }).join('');
        }

        // Function to set the initial date range (last 12 months)
        function setReviewDateRange() {
            reviewDateRange = [];
            const today = new Date();
            for (let i = 11; i >= 0; i--) {
                const date = new Date(today.getFullYear(), today.getMonth() - i, 1);
                const year = date.getFullYear();
                // Get month in 'MM' format
                const month = String(date.getMonth() + 1).padStart(2, '0'); 
                reviewDateRange.push(`${year}-${month}`);
            }
        }

        // Function to initialize the app
        async function initData() {
            setReviewDateRange();
            await fetchEmployeeData();
            // Now that we have the employee list, generate the simulated data
            generateSimulatedData(employees);
            renderSidebar();
            // Open the rep list by default
            toggleSection('rep');
            
            // Set the default theme on load
            const savedTheme = localStorage.getItem('app-theme') || 'winter';
            applyTheme(savedTheme);
            document.getElementById('theme-select').value = savedTheme;
        }

        // Function to apply theme
        function applyTheme(theme) {
            document.documentElement.setAttribute('data-theme', theme);
            localStorage.setItem('app-theme', theme);
            // Re-render chart to pick up new colors (if it exists)
            if (chartInstance) {
                updateChart();
            }
        }

        // Function to render the entire sidebar (called on startup and after filtering)
        function renderSidebar() {
            // Clear all lists first
            document.getElementById('list-dept').innerHTML = '';
            document.getElementById('list-mgr').innerHTML = '';
            document.getElementById('list-sup').innerHTML = '';
            document.getElementById('list-rep').innerHTML = '';
            
            let repsToDisplay = employees;

            if (currentFilter.type !== 'All') {
                repsToDisplay = employees.filter(emp => {
                    if (currentFilter.type === 'dept') return emp.dept === currentFilter.value;
                    if (currentFilter.type === 'mgr') {
                        const manager = employeeMap[emp.managerId];
                        return manager && manager.name === currentFilter.value;
                    }
                    if (currentFilter.type === 'sup') {
                        const supervisor = employeeMap[emp.supervisorId];
                        return supervisor && supervisor.name === currentFilter.value;
                    }
                    if (currentFilter.type === 'GoldStar') return emp.isGoldStar;
                    return true;
                });
            }
            
            setupHierarchy(repsToDisplay);

            // Reapply active class to filter button if necessary
            const allButtons = document.querySelectorAll('.hierarchy-item');
            allButtons.forEach(btn => {
                const typeMatch = btn.getAttribute('onclick').includes(currentFilter.type);
                const valueMatch = btn.getAttribute('onclick').includes(`'${currentFilter.value}'`) || (currentFilter.type === 'GoldStar' && currentFilter.value === true);
                if (typeMatch && valueMatch) {
                    btn.classList.add('active');
                }
            });
        }


        // Function to toggle sidebar sections
        function toggleSection(section) {
            const list = document.getElementById(`list-${section}`);
            const chev = document.getElementById(`chev-${section}`);
            if (list.style.display === 'none' || list.style.display === '') {
                list.style.display = 'block';
                chev.textContent = '‚ñ≤';
            } else {
                list.style.display = 'none';
                chev.textContent = '‚ñº';
            }
        }

        // Function to handle filtering the rep list (not actively filtering the list, but highlighting relevant items)
        function filterReps(type, value, element) {
            // Clear active state from all hierarchy-item buttons
            document.querySelectorAll('.hierarchy-item').forEach(btn => btn.classList.remove('active'));

            if (currentFilter.type === type && currentFilter.value === value) {
                // If the same filter is clicked, clear the filter
                currentFilter = { type: 'All', value: null };
                document.getElementById('view-title').textContent = 'Dashboard';
                document.getElementById('view-subtitle').textContent = 'Select an employee';
            } else {
                // Apply the new filter
                currentFilter = { type, value };
                element.classList.add('active');
                document.getElementById('view-title').textContent = `${value}`;
                document.getElementById('view-subtitle').textContent = `Filtered by ${type}`;
            }
            // We re-render the sidebar to show the filtered view (though the current code just uses the filter for highlighting and the view title)
            renderSidebar();
        }

        // Function to generate the HTML for a KPI row
        function createKpiRow(kpi, currentReview) {
            const reviewKpi = currentReview.kpiData.find(d => d.id === kpi.id);
            if (!reviewKpi) return '';

            const actual = reviewKpi.actual;
            const target = reviewKpi.target;
            const isBetter = reviewKpi.trend === 'up'; // Simple trend check
            const trendIcon = reviewKpi.trend === 'up' ? '‚ñ≤' : '‚ñº';
            const trendColor = isBetter ?
                'text-green-600' : 'text-red-600';
            const trendLabel = isBetter ? 'Better' : 'Worse';

            // Formatting logic
            let actualDisplay;
            let targetDisplay;
            if (kpi.type === 'percent') {
                actualDisplay = `${(actual * 100).toFixed(1)}%`;
                targetDisplay = `${target}%`;
            } else if (kpi.type === 'currency') {
                actualDisplay = `$${Math.round(actual).toLocaleString()}`;
                targetDisplay = `$${target.toLocaleString()}`;
            } else {
                actualDisplay = Math.round(actual).toLocaleString();
                targetDisplay = target.toLocaleString();
            }

            return `
                <tr class="border-b border-color last:border-b-0 text-main">
                    <td class="px-4 py-2 text-left">${kpi.label}</td>
                    <td class="px-4 py-2 text-right text-muted">${targetDisplay}</td>
                    <td class="px-4 py-2 text-right font-bold">${actualDisplay}</td>
                    <td class="px-4 py-2 text-center text-sm font-bold ${trendColor}">${trendIcon} ${trendLabel}</td>
                </tr>
            `;
        }
        
        // Function to populate the main dashboard view with review data
        function loadRepDashboard(repId) {
            if (!repId) return;
            currentRepId = repId;
            const rep = employeeMap[repId];
            if (!rep) return;

            // Set title and details
            document.getElementById('view-title').textContent = rep.name;
            document.getElementById('view-subtitle').textContent = `${rep.role} - ${rep.dept}`;
            const manager = employeeMap[rep.managerId];
            document.getElementById('manager-name').textContent = manager ? manager.name : 'N/A';
            document.getElementById('btn-new-review').style.display = 'block';

            // Find reviews for the rep and sort them
            const repReviews = dbReviews.filter(r => r.repId === repId).sort((a, b) => new Date(a.reviewDate) - new Date(b.reviewDate));

            if (repReviews.length === 0) {
                document.getElementById('kpi-table-body').innerHTML = `<tr><td colspan="4" class="text-center py-8 text-muted">No reviews found for this rep.</td></tr>`;
                document.getElementById('page-review').classList.add('active');
                document.getElementById('page-create').classList.remove('active');
                // Clear other sections
                return;
            }

            // Set up the slider range (0 to max index)
            const slider = document.getElementById('review-date-slider');
            slider.min = 0;
            slider.max = repReviews.length - 1;
            slider.value = repReviews.length - 1;
            // Default to the latest review

            // Store the reviews for easy lookup
            repReviews.forEach((review, index) => review.sliderIndex = index);
            rep.reviews = repReviews;

            // Initialize the KPI select dropdown for the chart
            const firstReviewKpis = repReviews[0].kpiData;
            const chartKpiSelect = document.getElementById('chart-kpi-select');
            chartKpiSelect.innerHTML = firstReviewKpis.map(kpi => `<option value="${kpi.id}">${kpi.label}</option>` ).join('');

            // Display the latest review
            updateDashboardFromSlider();
            
            // Show the review page
            document.getElementById('page-review').classList.add('active');
            document.getElementById('page-create').classList.remove('active');
        }

        // Function to update the dashboard based on the slider/date selection
        function updateDashboardFromSlider() {
            const rep = employeeMap[currentRepId];
            if (!rep || !rep.reviews) return;

            const slider = document.getElementById('review-date-slider');
            const index = parseInt(slider.value);
            currentReview = rep.reviews[index];
            document.getElementById('current-review-date-display').textContent = currentReview.reviewDate;

            // 1. KPI Table
            const kpiConfig = kpiConfigs[rep.dept] || kpiConfigs["Sales"];
            document.getElementById('kpi-table-body').innerHTML = kpiConfig.map(kpi => createKpiRow(kpi, currentReview) ).join('');

            // 2. Qualitative Feedback
            document.getElementById('text-opps-this').innerHTML = currentReview.oppsThis.split('\n').map(line => `<li>${line}</li>`).join('');
            document.getElementById('text-action-plan').innerHTML = currentReview.actionPlan.split('\n').map(line => `<li>${line}</li>`).join('');
            document.getElementById('text-best-practices').innerHTML = currentReview.bestPractices.split('\n').map(line => `<li>${line}</li>`).join('');
            document.getElementById('text-agent-voice').textContent = currentReview.agentVoice;

            // Find Previous Review for comparison
            const previousReview = rep.reviews.find(r => r.reviewId === currentReview.previousReviewId);
            document.getElementById('text-opps-last').innerHTML = previousReview ? 
                previousReview.oppsThis.split('\n').map(line => `<li class="text-muted">${line}</li>`).join('') :
                '<li class="text-muted">No previous review found.</li>';
                
            // 3. Update Chart
            updateChart();
        }

        // Function to open the export/print modal
        function openExportModal() {
            if (!currentReview) return alert("Select an employee and a review first.");

            const rep = employeeMap[currentRepId];
            const review = currentReview;
            const kpiConfig = kpiConfigs[rep.dept] || kpiConfigs["Sales"];

            // Set Print Header Details
            document.getElementById('print-subtitle').textContent = `${rep.role} - ${rep.dept}`;
            document.getElementById('print-date').textContent = `Review Period Ending: ${review.reviewDate}`;

            // Build Print KPI Table
            const printTableBody = document.getElementById('print-table-body');
            printTableBody.innerHTML = kpiConfig.map(config => {
                const kpi = review.kpiData.find(d => d.id === config.id);
                if (!kpi) return '';

                // Formatting (copied from createKpiRow)
                let actualDisplay, targetDisplay;
                if (config.type === 'percent') {
                    actualDisplay = `${(kpi.actual * 100).toFixed(1)}%`;
                    targetDisplay = `${config.target}%`;
                } else if (config.type === 'currency') {
                    actualDisplay = `$${Math.round(kpi.actual).toLocaleString()}`;
                    targetDisplay = `$${config.target.toLocaleString()}`;
                } else {
                    actualDisplay = Math.round(kpi.actual).toLocaleString();
                    targetDisplay = config.target.toLocaleString();
                }
                const status = (kpi.trend === 'up') ? 'üëç Exceeding' : '‚ö†Ô∏è Needs Focus';
                const statusColor = (kpi.trend === 'up') ? 'text-green-600' : 'text-red-600';
                
                return `
                    <tr>
                        <td class="p-2">${kpi.label}</td>
                        <td class="p-2 text-right">${targetDisplay}</td>
                        <td class="p-2 text-right font-bold">${actualDisplay}</td>
                        <td class="p-2 text-center text-sm font-bold ${statusColor}">${status}</td>
                    </tr>
                `;
            }).join('');

            const printTextContent = document.getElementById('print-text-content');
            printTextContent.innerHTML = `
                <div><h4 class="font-bold text-lg">üéØ Opportunities</h4><ul class="list-disc ml-6">${review.oppsThis.split('\n').map(line => `<li>${line}</li>`).join('')}</ul></div>
                <div><h4 class="font-bold text-lg">üöÄ Action Plan</h4><ul class="list-disc ml-6">${review.actionPlan.split('\n').map(line => `<li>${line}</li>`).join('')}</ul></div>
                <div><h4 class="font-bold text-lg">‚ú® Best Practices</h4><ul class="list-disc ml-6">${review.bestPractices.split('\n').map(line => `<li>${line}</li>`).join('')}</ul></div>
                <div><h4 class="font-bold text-lg">üó£Ô∏è Agent's Voice</h4><p class="italic p-3 bg-gray-100 rounded">${review.agentVoice}</p></div>
            `;
            
            window.print();
        }

        // Function to update the trend chart
        function updateChart() {
            const rep = employeeMap[currentRepId];
            if (!rep) return;
            const kpiId = document.getElementById('chart-kpi-select').value;
            const duration = parseInt(document.getElementById('duration-select').value);
            const logs = dbLogs.filter(log => log.repId === currentRepId && log.kpiId === kpiId);

            // Slice logs based on duration (show last 'duration' months)
            const relevantLogs = logs.slice(Math.max(logs.length - duration, 0));

            if (chartInstance) {
                chartInstance.destroy();
            }

            const ctx = document.getElementById('trendChart').getContext('2d');

            // Get KPI config for target line
            const repKpiConfig = kpiConfigs[rep.dept] || kpiConfigs["Sales"];
            const kpiConfig = repKpiConfig.find(k => k.id === kpiId);

            chartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: relevantLogs.map(log => log.date),
                    datasets: [
                        {
                            label: `${kpiConfig.label} Actual`,
                            data: relevantLogs.map(log => log.value),
                            borderColor: 'var(--primary)',
                            backgroundColor: 'rgba(var(--primary-rgb), 0.1)',
                            fill: true,
                            tension: 0.4
                        },
                        {
                            label: `${kpiConfig.label} Target`,
                            data: relevantLogs.map(() => kpiConfig.target),
                            borderColor: 'var(--text-muted)',
                            borderDash: [5, 5],
                            backgroundColor: 'transparent',
                            pointRadius: 0
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: kpiConfig.type !== 'percent',
                            title: {
                                display: true,
                                text: kpiConfig.label,
                                color: 'var(--text-main)'
                            },
                            ticks: {
                                callback: function(value) {
                                    if (kpiConfig.type === 'percent') return (value * 100).toFixed(0) + '%';
                                    if (kpiConfig.type === 'currency') return '$' + Math.round(value).toLocaleString();
                                    return value.toLocaleString();
                                },
                                color: 'var(--text-muted)'
                            },
                            grid: { color: 'var(--border-color)' }
                        },
                        x: {
                            ticks: { color: 'var(--text-muted)' },
                            grid: { display: false }
                        }
                    },
                    plugins: {
                        legend: { labels: { color: 'var(--text-main)' } }
                    }
                }
            });
        }
        
        // --- 10. REVIEW CREATION ---
        function openCreateReviewModal() {
            if(!currentRepId) return alert("Select Rep first");
            const emp = employeeMap[currentRepId];
            
            document.getElementById('page-review').classList.remove('active');
            document.getElementById('page-create').classList.add('active');
            document.getElementById('btn-new-review').style.display = 'none';
            document.getElementById('new-review-rep-name').textContent = emp.name;
            
            // Set default date to current year/month
            const now = new Date();
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            document.getElementById('form-date').value = `${year}-${month}`;
            
            // Clear qualitative inputs
            document.getElementById('form-opps-this').value = '';
            document.getElementById('form-action-plan').value = '';
            document.getElementById('form-best-practices').value = '';
            document.getElementById('form-agent-voice').value = '';
            
            // Generate KPI Inputs
            const kpis = kpiConfigs[emp.dept] || kpiConfigs["Sales"];
            document.getElementById('form-kpi-inputs').innerHTML = kpis.map(k => 
                `<div><label class="block text-sm text-main">${k.label} (Target: ${k.type === 'percent' ? k.target + '%' : k.type === 'currency' ? '$' + k.target.toLocaleString() : k.target})</label><input type="number" step="${k.type === 'number' ? '1' : '0.1'}" id="kpi-${k.id}" class="w-full border border-color rounded p-2 bg-input text-main" placeholder="Actual Value"></div>`
            ).join('');
        }

        // --- 11. REVIEW MANAGEMENT FUNCTIONS (FIXED & IMPLEMENTED) ---

        // Helper to generate log data for a single review date (for charting)
        function generateLogDataForDate(rep, review, kpis, date) {
            kpis.forEach(kpi => {
                const reviewKpi = review.kpiData.find(d => d.id === kpi.id);
                if (reviewKpi) {
                    const log = {
                        logId: `${rep.id}-${kpi.id}-${date.replace('-', '')}-${Date.now()}`,
                        repId: rep.id,
                        kpiId: kpi.id,
                        date: date,
                        value: reviewKpi.actual
                    };
                    dbLogs.push(log);
                }
            });
        }
        
        // New function to simulate sending data to the Save Flow
        async function sendDataToFlow(reviewData) {
            try {
                // In a real application, you would use the following fetch to send data:
                const response = await fetch(SAVE_DATA_FLOW_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(reviewData)
                });
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                await new Promise(resolve => setTimeout(resolve, 500)); // Simulate network delay
                return true; // Assume success
            } catch (error) {
                console.error("Failed to send review data to Power Automate Flow (simulated):", error);
                alert("Error: Failed to save review. Please check the console for details.");
                return false;
            }
        }

        // Function to save the new review (Full implementation to replace placeholder)
        async function saveNewReview() {
            if (!currentRepId) return alert("Error: No representative selected.");

            const rep = employeeMap[currentRepId];
            const reviewDate = document.getElementById('form-date').value;
            const reviewType = document.getElementById('form-type').value;
            
            if (!reviewDate) return alert("Please select a review date.");

            // 1. Collect KPI Data
            const kpiInputsContainer = document.getElementById('form-kpi-inputs');
            const kpiInputs = kpiInputsContainer.querySelectorAll('input[id^="kpi-"]');
            const kpiData = [];
            let allKpiValid = true;

            const kpiConfig = kpiConfigs[rep.dept] || kpiConfigs["Sales"];

            kpiInputs.forEach(input => {
                const kpiId = input.id.replace('kpi-', '');
                const config = kpiConfig.find(k => k.id === kpiId);
                const actualValue = parseFloat(input.value);

                if (input.value.trim() === "" || isNaN(actualValue)) {
                    allKpiValid = false;
                }

                if (config) {
                    kpiData.push({
                        id: kpiId,
                        label: config.label,
                        target: config.target, 
                        actual: actualValue,
                        // Trend logic: 'up' if actual meets/exceeds target (or is less for inverse KPIs like AHT)
                        trend: (config.inverse ? (actualValue < config.target ? 'up' : 'down') : (actualValue >= config.target ? 'up' : 'down')), 
                        type: config.type,
                        agg: config.agg
                    });
                }
            });

            if (!allKpiValid) return alert("Please enter a valid number for all KPI inputs.");

            // 2. Collect Qualitative Data (using the newly added IDs)
            const oppsThis = document.getElementById('form-opps-this').value;
            const actionPlan = document.getElementById('form-action-plan').value;
            const bestPractices = document.getElementById('form-best-practices').value;
            const agentVoice = document.getElementById('form-agent-voice').value;
            
            if (!oppsThis || !actionPlan || !bestPractices) return alert("Please fill out Opportunities, Action Plan, and Best Practices.");

            // 3. Construct Review Object
            const repReviews = dbReviews.filter(r => r.repId === currentRepId).sort((a, b) => new Date(a.reviewDate) - new Date(b.reviewDate));
            const newReview = {
                reviewId: `${rep.id}-${reviewDate.replace('-', '')}-${Date.now()}`, 
                repId: rep.id,
                repName: rep.name,
                reviewDate: reviewDate,
                type: reviewType,
                reviewerLevel: 'Manager',
                kpiData: kpiData,
                oppsThis: oppsThis,
                actionPlan: actionPlan,
                bestPractices: bestPractices,
                agentVoice: agentVoice,
                previousReviewId: repReviews.length > 0 ? repReviews[repReviews.length - 1].reviewId : null
            };

            // 4. Send Data and Update Local State
            const success = await sendDataToFlow(newReview);
            
            if(success) {
                // Add to local state
                dbReviews.push(newReview);
                // Add to local logs for charting
                generateLogDataForDate(rep, newReview, kpiConfig, reviewDate);

                // Switch back to the dashboard view
                document.getElementById('page-create').classList.remove('active');
                document.getElementById('btn-new-review').style.display = 'block';
                alert(`New Review for ${rep.name} on ${reviewDate} saved successfully! (Simulated)`);
                loadRepDashboard(currentRepId);
            }
        }

        
        function openExportModal() { window.print(); }
        
        function triggerFlowSync() { alert("Syncing..."); }

        // Initialize App after DOM Content Loaded to prevent null reference errors
        document.addEventListener('DOMContentLoaded', initData);

    </script>
</body>
</html>
